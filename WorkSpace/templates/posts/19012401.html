<hr>

<h1>iOS æ¥å…¥webSocket</h1>

<blockquote>
<p>å‰æ®µæ—¶é—´ç”¨åˆ°äº†webSocket,åœ¨æŸåº¦äº†å¥½ä¹…ä¹‹åè¿˜æ˜¯æ²¡æœ‰å‘ç°ä¸€äº›æ¯”è¾ƒå…¨é¢çš„,æ‰€ä»¥è‡ªå·±è®°å½•ä¸‹æ¥ä¸€ç‚¹</p>
</blockquote>

<p>é¦–å…ˆå¯¼å…¥äº†squareå¤§ç¥çš„SocketRocket(ç®€ç§°SR,åº”è¯¥æ˜¯iOSç«¯webSocketé‡‡ç”¨æ¯”è¾ƒå¤šçš„æ¡†æ¶),æ¯”è¾ƒç®€å•,å‘é€æ¶ˆæ¯å‚æ•°éœ€è¦å’Œåå°çº¦å®šå¥½</p>

<h4>1&gt; åˆ›å»ºSRWebSocket</h4>

<p>æˆ‘è¿™è¾¹åˆ›å»ºäº†ä¸€ä¸ªwebSocketçš„å•ä¾‹ç±»,åœ¨å•ä¾‹ç±»é‡Œå®ä¾‹åŒ–SRWebSocketå¹¶ä¸”è®¾ç½®ä»£ç†</p>

<pre><code class="lang-objective-c">SRWebSocket *webSocket;
webSocket.delegate = nil;
[webSocket close];
webSocket = [[SRWebSocket alloc]initWithURLRequest:url];//è¿™é‡Œçš„urlæ˜¯ä¸€ä¸ªéµå®ˆwsåè®®çš„å¼€å¤´æ˜¯&#39;ws://&#39;çš„
webSocket.delegate = self;  //è®°å¾—è¦éµå®ˆåè®®&lt;SRWebSocketDelegate&gt;,å®ç°delegateæ–¹æ³•
[webSocket open];   //æ‰“å¼€socketé€šé“

--&lt;SRWebSocketDelegate&gt;
- (void)webSocketDidOpen:(SRWebSocket *)webSocket;{
    NSLog(@&quot;å½“è¿›å…¥è¿™ä¸ªä»£ç†æ–¹æ³•çš„æ—¶å€™è¯´æ˜socketé€šé“å·²ç»æ‰“å¼€&quot;);
}

- (void)webSocket:(SRWebSocket *)webSocket didFailWithError:(NSError *)error {
    NSLog(@&quot;è¿æ¥å¤±è´¥ï¼Œè¿™é‡Œå¯ä»¥å®ç°æ‰çº¿è‡ªåŠ¨é‡è¿&quot;);
}

- (void)webSocket:(SRWebSocket *)webSocket didCloseWithCode:(NSInteger)code reason:(NSString *)reason wasClean:(BOOL)wasClean;{

    [webSocket close];  //å…³é—­socket
    webSocket = nil;
    NSLog(@&quot;socketé€šé“æ–­å¼€äº†,æ–­å¼€ä¸€èˆ¬æ˜¯æœåŠ¡å™¨ä¸»åŠ¨æ–­å¼€çš„,è¿™ä¸ªæ—¶å€™å¯ä»¥è¿›è¡Œé‡è¿&quot;);


}

- (void)webSocket:(SRWebSocket *)webSocket didReceiveMessage:(id)message;{

    NSLog(@&quot;Received \&quot;%@\&quot;&quot;, message);
    NSLog(@&quot;è¿™é‡Œæ˜¯æ”¶åˆ°æœåŠ¡å™¨æ¨æ¥çš„æ¶ˆæ¯ ä¸€èˆ¬æ˜¯JSONæ ¼å¼&quot;);
}

- (void)sendData:(id)data {

    if (socket.readyState == SR_OPEN) {

        [socket send:data];    // å‘é€æ•°æ®,è¿™é‡Œè¦socketæ‰“å¼€æ‰èƒ½å‘é€,ä¸ç„¶ä¼šcrashes
    }
}




</code></pre>

<p>,ä¸ç„¶ä¼šcrashes
    }
}




</code></pre>

<p>